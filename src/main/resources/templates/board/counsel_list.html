<div xmlns:th="http://www.thymeleaf.org"
     xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
     layout:decorate="~{layouts/default}"
     layout:fragment="content">

  <th:block layout:fragment="custom_css">
    <link rel="stylesheet" th:href="@{/css/board/board.css}" />
  </th:block>

  <div th:replace="fragments/menu/header :: menu_header"></div>

  <div class="container my-5">
    <h2 class="section-title mb-4">ìƒë‹´ ë‚´ì—­</h2>

    <button class="btn btn-outline-light mb-3" type="button" data-bs-toggle="collapse" data-bs-target="#search_form" aria-expanded="false" aria-controls="searchCollapse">
      ğŸ” ê²€ìƒ‰ ì—´ê¸°/ë‹«ê¸°
    </button>

    <!-- ê²€ìƒ‰ ì˜ì—­ -->
    <form id="search_form"
          method="GET"
          class="collapse"
          action="/counsel">
      <div class="search-section bg-dark p-3 rounded mb-4">

        <!-- ë‚ ì§œ ì‹œì‘ -->
        <div class="mb-3 position-relative">
          <label for="search_start_date" class="form-label text-white fw-semibold">ì‹œì‘ ë‚ ì§œ</label>
          <div class="input-group" id="flatPickerStartDate" data-wrap="true">
            <input type="text"
                   id="search_start_date"
                   name="search_start_date"
                   class="form-control"
                   placeholder="YYYY-MM-DD"
                   th:value="${searchParamMap.search_start_date}"
                   data-input />
            <span class="input-group-text bg-secondary text-white" data-open>
                <i class="bi bi-calendar3"></i>
            </span>
          </div>
        </div>

        <!-- ë‚ ì§œ ì¢…ë£Œ -->
        <div class="mb-3 position-relative">
          <label for="search_end_date" class="form-label text-white fw-semibold">ì¢…ë£Œ ë‚ ì§œ</label>
          <div class="input-group" id="flatPickerEndDate" data-wrap="true">
            <input type="text"
                   id="search_end_date"
                   name="search_end_date"
                   class="form-control"
                   placeholder="YYYY-MM-DD"
                   th:value="${searchParamMap.search_end_date}"
                   data-input />
            <span class="input-group-text bg-secondary text-white" data-open>
                <i class="bi bi-calendar3"></i>
            </span>
          </div>
        </div>

        <!-- ê³ ê°ëª… -->
        <div class="mb-3">
          <label for="search_customer_name" class="form-label text-white fw-semibold">ê³ ê°ëª…</label>
          <input type="text"
                 id="search_customer_name"
                 name="search_customer_name"
                 class="form-control"
                 placeholder="ê³ ê°ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"
                 autocomplete="off"
                 th:value="${searchParamMap.search_customer_name}"
          />
        </div>

        <!-- ê²€ìƒ‰ + ì´ˆê¸°í™” ë²„íŠ¼ ê·¸ë£¹ -->
        <div class="d-flex flex-column flex-md-row gap-2">
          <button type="button" id="btnSearch" class="btn btn-warning flex-grow-1">ê²€ìƒ‰</button>
          <button type="button" id="btnSearchReset" class="btn btn-secondary flex-grow-1">ì´ˆê¸°í™”</button>
        </div>
      </div>
    </form>

    <table class="table table-dark">
      <colgroup>
        <col style="width: 8%" />
        <col />
        <col />
        <col />
        <col />
        <col />
      </colgroup>
      <thead class="thead_list">
        <tr>
          <th>No</th>
          <th>ìƒë‹´ìš”ì²­ì</th>
          <th class="hide-mobile">ìƒë‹´ì¢…ë¥˜</th>
          <th class="hide-mobile">ìƒë‹´ë°©ë²•</th>
          <th>ì§„í–‰ìƒíƒœ</th>
          <th class="hide-mobile">ë“±ë¡ì‹œê°</th>
        </tr>
      </thead>
      <tbody>
        <tr class="tr-click-row"
            th:each="counsel, stat: ${counsels}">
          <td th:text="${pages.pagingStartNo - stat.index}"></td>
          <td th:text="${counsel.customerName}" class="text-center"></td>
          <td class="hide-mobile text-center"
              th:text="${counsel.counselKind == 'ì¹­ì°¬' ? 'ğŸ·ï¸ ' + counsel.counselKind :
              counsel.counselKind == 'ë¶ˆë§Œ' ? 'ğŸ˜  ' + counsel.counselKind :
              counsel.counselKind == 'í™˜ë¶ˆ' ? 'ğŸ’° ' + counsel.counselKind :
              counsel.counselKind == 'êµí™˜' ? 'ğŸ”„ ' + counsel.counselKind :
              counsel.counselKind == 'ê±´ì˜' ? 'ğŸ’¡ ' + counsel.counselKind :
              counsel.counselKind == 'ì…ì ' ? 'ğŸª ' + counsel.counselKind : ''}">
          </td>
          <td class="hide-mobile text-center"
              th:text="${counsel.counselMethod == 'ì „í™”' ? 'ğŸ“ ' + counsel.counselMethod :
              counsel.counselMethod == 'ì´ë©”ì¼' ? 'ğŸ“§ ' + counsel.counselMethod : ''}">
          </td>
          <td class="text-center"
              th:text="${counsel.progressState == 'ëŒ€ê¸°' ? 'ğŸ’¤ ' + counsel.progressState :
              counsel.progressState == 'ì§„í–‰ì¤‘' ? 'â³ ' + counsel.progressState :
              counsel.progressState == 'ì™„ë£Œ' ? 'âœ… ' + counsel.progressState :
              counsel.progressState == 'ë³´ë¥˜' ? 'â¸ï¸ ' + counsel.progressState : ''}">
          </td>
          <td class="hide-mobile text-center"
              th:text="${#temporals.format(counsel.registerDatetime, 'yyyy-MM-dd HH:mm:ss')}"></td>
        </tr>

        <tr class="no-data-row" th:if="${counsels.size() == 0}">
          <td colspan="6">ë“±ë¡ëœ ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.</td>
        </tr>
      </tbody>
    </table>

    <div class="text-end my-3">
      <a th:href="@{/counsel/write}"
         class="btn btn-warning">âœï¸ ìƒë‹´ì‹ ì²­
      </a>
    </div>

    <nav th:replace="fragments/pagination :: pagination(
            pages=${pages},
            searchParamMap=${searchParamMap},
            queryString=${queryString})">
    </nav>
  </div>
</div>

<th:block layout:fragment="custom_js">
  <script th:src="@{/js/board/counsel.js}"></script>
  <script>
    const startPicker = flatpickr("#flatPickerStartDate", {
        dateFormat: "Y-m-d",
        locale: "ko",
        maxDate: "today",
        defaultDate: $("#search_start_date").val() || FLATPICKR_ONE_MONTH,
        wrap: true,
        disableMobile: true
    });

    const endPicker = flatpickr("#flatPickerEndDate", {
        dateFormat: "Y-m-d",
        locale: "ko",
        maxDate: "today",
        defaultDate: $("#search_end_date").val() || FLATPICKR_COMMON_TODAY,
        wrap: true,
        disableMobile: true
    });
  </script>
</th:block>